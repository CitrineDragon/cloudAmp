<script defer src="/js/helper.js"></script>

<%- include('partials/header') -%>

<nav class="navbar navbar-expand-lg fixed-top navbar-dark">
  <div class="container-fluid">
    <a class="navbar-brand text-info" href="/main">Cloud<span class="text-light">Amp</span></a>
    <button class="navbar-toggler shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon d-flex justify-content-center align-items-center"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarMenu">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link text-info" href="#"><%= user.userName %></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/upload">Upload</a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-none" href="/profile">Profile</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logout">Sign Out</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<% let songIndex = 0 %>

<!-- Hero -->
<!-- <div class="container-fluid d-flex flex-column justify-content-center align-items-center first hero bg-primary bg-gradient text-light">
  <h2>CloudAmp</h2>
  <p>Your Music, Anywhere!</p>
</div> -->

<div class="hero first video-background-holder">
  <div class="video-background-overlay-2"></div>
  <video playsinline="playsinline" autoplay="autoplay" muted="muted" loop="loop">
    <source src="https://res.cloudinary.com/drfh0vi5h/video/upload/v1677351906/indexBG_fqgznx.mp4" type="video/mp4" />
  </video>
</div>


<!-- Song Library -->
<div class="library container-fluid text-light bg-dark">
  <div class="songHeader text-info">
    <div class="row py-2 d-flex border-bottom border-secondary">
      <span class="col-1 justify-content-center d-none d-sm-flex"></span>
      <span class="col ">Title</span>
      <span class="col d-none d-lg-flex">Artist</span>
      <span class="col d-none d-lg-flex">Album</span>
      <span class="col-1 justify-content-center d-none d-sm-flex">Duration</span>
      <span class="col-1 text-center"></span>
    </div>
  </div>
  <div class="songParent pb-5">
    <% for(var i=0; i<songs.length; i++) {%>
    <div class="songDiv row d-flex" onclick="songDivIndex(this)">
      <span class="col-1 py-1 border-bottom border-secondary d-flex justify-content-center align-items-center img-fluid d-none d-sm-flex"><img class="trackCoverArt" src="<%= songs[i].imageURL%>" alt="ALbum Cover Art"></span>
      <span class="col py-1 border-bottom border-secondary d-flex align-items-center"><%= songs[i].title %></span>
      <span class="col py-1 border-bottom border-secondary d-flex align-items-center d-none d-lg-flex"><%= songs[i].artist%></span>
      <span class="col py-1 border-bottom border-secondary d-flex align-items-center d-none d-lg-flex"><%= songs[i].album%></span>
      <span class="col-1 py-1 border-bottom border-secondary d-flex justify-content-center align-items-center d-none d-sm-flex">
        <% let minutes = Math.floor(songs[i].duration / 60) %>
        <% let seconds = (songs[i].duration - minutes * 60).toFixed() %>
        <%= `${minutes}:${seconds < 10 ? '0' + seconds : seconds }` %>
      </span>
      <span class="col-1 py-1 border-bottom border-secondary d-flex justify-content-center align-items-center"><a href="/delete/<%= songs[i]._id %>" title="delete" class="trash"><i class="fa-solid fa-trash py-1 text-light"></i></a></span>
    </div>
    <% } %>
  </div>
</div>


<!-- Music Player -->
<div class="player container-fluid pt-3 position-absolute bottom-0 start-0" data-songs="<%= JSON.stringify(songs) %>">
  <div class="progressSection d-flex justify-content-center align-items-center">
    <!-- Current Time -->
    <span class="cDur text-end text-light me-2">0:00</span>
    <!-- Progress Bar -->
    <span class="progress">
      <div class="progress-bar bg-info" role="progressbar" title="" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="<%= songs[songIndex]?.duration || 0 %>"></div>
    </span>
    <!-- Max Duration -->
    <span class="mDur text-light ms-2">0:00</span>
  </div>


  <div class="d-flex col justify-content-between text-light mt-1">
    <!-- Track Img & Details -->
    <div class="playerDetails col d-flex d-none d-lg-flex">
      <img src="<%= songs[songIndex]?.imageURL || 'https://res.cloudinary.com/drfh0vi5h/image/upload/v1676690365/musicIcon_zjv3ss.jpg'%>" alt="music-cover" class="cover  d-none d-md-block" id="cover" />
      <div class="trackDetails d-flex flex-column align-items-start justify-content-center ">
        <span class="title ps-2"><%= songs[songIndex]?.title || 'None' %></span>
        <span class="artist ps-2"><%= songs[songIndex]?.artist || 'None'%></span>
      </div>
    </div>

    <audio src="<%= songs[songIndex]?.songURL || ''%>" id="audio"></audio>

    <!-- Player Controls -->
    <div class="playerControls col d-flex justify-content-center align-items-center">
      <button id="prev" class="playerBtn prev btn text-light shadow-none mx-1" title="Previous Track">
        <i class="fas fa-backward"></i>
      </button>
      <button id="play" class="playerBtn play btn btn-outline-info shadow-none mx-1" title="Play Track">
        <i class="fas fa-play"></i>
      </button>
      <button id="next" class="playerBtn next btn text-light shadow-none mx-1" title="Next Track">
        <i class="fas fa-forward"></i>
      </button>
    </div>

    <!-- Volume Control -->
    <div class="volumeControl col d-flex justify-content-end align-items-center text-light d-none d-lg-flex">
      <i class="playerVolume fa-solid fa-volume-high text-info pe-2"></i>
      <label for="volumeRange" class="form-label"></label>
      <input type="range" class="form-range" min="0" max="100" step="1" value="100" id="volumeRange" name="volumeRange" placeholder="">
    </div>
  </div>

</div>





<%- include('partials/footer') -%>